\documentclass[paper=a4, fontsize=11pt]{tccv}          % Unfortynately must keep some stuff in class for now

% 0/ Default settings
\providecommand{\tbfbordertop}{0.6}
\providecommand{\tbfborderleft}{0.6}
\providecommand{\tbflanguage}{english}
\providecommand{\tbfcmd}{two_column}

% API
\usepackage{xargs}                          % Key - value parameters
\usepackage{xcolor}
\usepackage{pgf}                            % Math macro
\usepackage{xifthen}                        % If, else block

% Switch Html / Pdf for mdframe
\ifx\HCode\undefined
    \usepackage{fontspec}                       % Awesome font not available on html
    \usepackage{url}                            % Clickable URL's
    \hypersetup{hidelinks}                      % Hide links
\else
\fi

% Drawings
\usepackage[framemethod=TikZ]{mdframed}     % Box around text
\ifx\HCode\undefined
    \usepackage[absolute, overlay]{textpos}     % For Textblock
    \setlength{\TPHorizModule}{1cm}
    \setlength{\TPVertModule}{1cm}
\else
    \usepackage[overlay]{textpos}               % For Textblock
    \setlength{\TPHorizModule}{28pt}
    \setlength{\TPVertModule}{28pt}
\fi
\usepackage{graphicx}                       % Include foto
\usepackage{tabularx}                       % Coordinates
\usepackage{enumitem}                       % Aptitudes enumeration
\usepackage{genealogytree}                  % Born

% Display + Margin
\tolerance=1000


% Font
\usepackage{amsfonts}                       % Checkmark
\usepackage{relsize}                        % Scale font
\usepackage{everysel}
\EverySelectfont{%                          % This percent is important otherwise I got space befor paragph
    \fontdimen2\font=0.3em                  % Interword space
    \hyphenchar\font=`\-                    % Allow hyphenation
    \xspaceskip=0em
}


% Helper
\providecommand\mission[1]{\makebox[1.6cm][l]{\textbf{#1}}}
\let\cvitem\item


% ===========================================================================================================================


% -2/ must be configured
\newif\iftbftiny
\input{../Cmd/cmd_include}




% 1/ Commands
\newcommand\tbflogo[1]{\includegraphics[width=12pt, height=12pt]{#1}}

\newcommand\tbfimflag[1]{\includegraphics[height=12pt]{#1}\phantom{\tiny{1}}}

\newcommand\tbfsoft[2]{\includegraphics[height=12pt]{#2}\phantom{\tiny{1}}#1}

\newcommand\tbfpart[1]{#1}

\newcommand\tbfname[2]{
  \pgfmathsetmacro{\tbftmp}{\tbfbordertop + 0.6}
  \begin{textblock}{23}(0, \tbftmp)
     \centering{\headerfirstnamestyle{#1} \hspace{5pt} \headerlastnamestyle{#2}}
  \end{textblock}
}

\newcommand\tbffoto[1]{
    \ifx\HCode\undefined
        \begin{textblock}{23}(17.7, \tbfbordertop)
            \includegraphics[width=2.8cm]{#1}
        \end{textblock}
    \else
    \fi
}


\newcommand\tbfdescription[2][16pt]{
  \pgfmathsetmacro{\tbftmp}{\tbfbordertop + 1.7}
  \begin{textblock}{23}(0, \tbftmp)
  \begin{center}

  {\fontsize{#1}{0.6cm} \scshape\bfseries #2}

  \end{center}
  \end{textblock}
}

\newcommand\tbfskilltwo[1]{\section{#1}}


% 2/ Helpers
% Name, size, x, y, nada
\newsavebox{\internalbox}
\newenvironment*{internal}[5]
{
    \ifx\HCode\undefined
        \begin{textblock}{#2}(#3, #4)
        \begin{mdframed}
    \else
        \begin{lrbox}{\internalbox}
        \begin{minipage}[t]{0.5\textwidth}
    \fi

    \section{#1}
}
{

    \ifx\HCode\undefined
        \end{mdframed}
        \end{textblock}
    \else
        \end{minipage}
        \end{lrbox}
        \usebox{\internalbox}
    \fi

}

\newenvironment*{rounded_frame}[5]
{
    \mdfsetup{
      middlelinecolor=mybluegrey,
      middlelinewidth=1pt,
      backgroundcolor=white!0,
      roundcorner=10pt,
      skipabove=30,
      fontcolor=black,
      innertopmargin=-10pt,
      innerrightmargin=17pt,
    }
    \begin{internal}{#1}{#2}{#3}{#4}{#5}
}
{
    \end{internal}
}


\newenvironment{flat_frame}[5]
{
    \mdfsetup{
      middlelinecolor=mybluegrey,
      middlelinewidth=1pt,
      backgroundcolor=white!0,
      roundcorner=10pt,
      skipabove=30,
      fontcolor=black,
      innertopmargin=-10pt,
      innerrightmargin=17pt,
      middlelinecolor=white!0
    }
    \begin{internal}{#1}{#2}{#3}{#4}{#5}
}
{
    \end{internal}
}





% 3/ ENVIRONMENT



% [coordinate][Width, X, Y]
\newenvironmentx{coordinatelist}{
    \needspace{0.5\textheight}
    \newdimen\boxwidth
    \boxwidth=\dimexpr\linewidth-2\fboxsep\relax
    \pgfmathsetmacro{\tbftmpleft}{\tbfborderleft + 1}
    \begin{textblock}{7}(\tbfborderleft, \tbfbordertop)
    \begin{tabular}{l|l}
}{
    \end{tabular}
  \end{textblock}
}

% [job] { years }  {company } { more }
%                                Width, X (horizontal), Y (vertical)
\newenvironmentx{joblist}[3][1=13.2, 2=7.8, 3=3.9]{
  \begin{flat_frame}{\wordwork}{#1}{#2}{#3}{}
  \relscale{1.27}
  \renewcommand\item[4][]{
    \vspace*{0.3cm}
      \iftbftiny \setlength{\parskip}{-10pt} \fi
    {\raggedleft\textsc{\bodyfont{##2}}\\[1pt]}                 % YEAR

    \textsc\bfseries{\bodyfont{##1}}\\[1pt]                   % POSTE
    \textsc\bodyfont{##3}\\[1pt]                            % COMPANY
    \bodyfontlight\upshape{##4}                                 % DESCRIPTION
    }
}{
  \end{flat_frame}
}

% Formation
\newenvironmentx{yearlist}[3][1=7.1, 2=0.7, 3=3.9]{
  \begin{rounded_frame}{\wordeducation}{#1}{#2}{#3}{}
  \relscale{1.2}
    \renewcommand\item[4][]{
    \textsc{\bodyfont{##2}}                                     % YEAR
            \hspace*{0.2cm}                                         % TODO align them because letter 0 takes more space than 1
            \textsc\bfseries{\bodyfont{##1}} \\[1pt]                % DIPLOME
    \textsc\bodyfont{##3}   \\                          % ETABLISSEMENT
    \textit\descriptionstyle{##4} \\                            % DESCRIPTION
    \vspace{-0.3cm} % reduce horizontal space
    }
}{
  \end{rounded_frame}
}


% Comp√©tence width, x, y
\newenvironmentx{skilllist}[3][1=7.1, 2=0.7, 3=15.2]{
  \begin{rounded_frame}{\wordlanguage}{#1}{#2}{#3}{}
  \relscale{1.2}
}{
  \end{rounded_frame}
}



\newcommand\tbfbirth[1]{
    \includegraphics[width=0.05\textwidth]{../Figure/logo/birthday1_128.png}    & \normalsize  \bodyfont{#1} \smallskip\\
}
\newcommand\tbfmail[1]{
    \Letter      & \normalsize  \bodyfont{#1}\smallskip\\
}
\newcommand\tbfaddr[1]{
    \Writinghand & \normalsize  \bodyfont{#1}\smallskip\\
}
\newcommand\tbftel[1]{
    \Telefon     & \normalsize  \bodyfont{#1}\smallskip\\
}
\newcommand\tbfvoidpersonal[1]{
    \hspace{1mm}    & \normalsize  \bodyfont{#1}\smallskip\\
}
\newcommand\tbfflag[1]{
    \includegraphics[width=0.05\textwidth]{../Figure/flag.png}    & \normalsize  \bodyfont{#1} \smallskip\\
}
\newcommand\tbfcar[1]{
    \includegraphics[width=0.05\textwidth]{../Figure/logo/car1_128.png}    & \normalsize  \bodyfont{#1} \smallskip\\
}
\newcommand\tbfwww[1]{
    \includegraphics[width=0.05\textwidth]{../Figure/logo/www_128.png}    & \normalsize  \bodyfont{#1} \smallskip\\
}


\newenvironment{languagelist}{
  \renewcommand\item[2]{
    ##1 & ##2 \\
  }
  \begin{tabular}[t]{ll}
}{
  \end{tabular}
}

\newenvironment{stufflist}{
  \renewcommand\item[2]{
    ##1 & ##2 \\
  }
  \setlength\tabcolsep{1.5pt} % default value: 6pt
  \begin{tabular}[]{p{0.1cm}p{6cm}}
}{
  \end{tabular}
}

